<!DOCTYPE html>
<html lang="en">
<head>

	<title>商品详情</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- jquery -->
	<script type="text/javascript" src="/js/jquery.min.js"></script>
	<!-- bootstrap -->
	<link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css" />
	<script type="text/javascript" src="/bootstrap/js/bootstrap.min.js"></script>
	<!-- jquery-validator -->
	<script type="text/javascript" src="/jquery-validation/jquery.validate.min.js"></script>
	<script type="text/javascript" src="/jquery-validation/localization/messages_zh.min.js"></script>
	<!-- layer -->
	<script type="text/javascript" src="/layer/layer.js"></script>
	<!-- md5.js -->
	<script type="text/javascript" src="/js/md5.min.js"></script>
	<!-- common.js -->
	<script type="text/javascript" src="/js/common.js"></script>

	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" href="images/favicon.png" type="image/x-icon">

	<title>DUTCH GREY BAG - Shop</title>

	<!-- Fonts -->
	<link rel="stylesheet" href="assets/fonts/Lato/Lato.css">

	<!-- Icons -->
	<link rel="stylesheet" href="assets/fonts/flaticon/flaticon.css">
	<link rel="stylesheet" href="assets/fonts/webfont/css/materialdesignicons.min.css">

	<!-- Libs -->
	<link rel="stylesheet" href="libs/bootstrap-4.3.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="libs/select2/css/select2.min.css">
	<link rel="stylesheet" href="libs/slick/slick.css">

	<!-- Theme -->
	<link rel="stylesheet" href="assets/css/style.css">
	<meta name="theme-color" content="#ECECEC">
	<!-- jquery -->
	<script type="text/javascript" src="/js/jquery.min.js"></script>
	<!-- bootstrap -->
	<link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css" />
	<script type="text/javascript" src="/bootstrap/js/bootstrap.min.js"></script>
	<!-- jquery-validator -->
	<script type="text/javascript" src="/jquery-validation/jquery.validate.min.js"></script>
	<script type="text/javascript" src="/jquery-validation/localization/messages_zh.min.js"></script>
	<!-- layer -->
	<script type="text/javascript" src="/layer/layer.js"></script>
	<!-- md5.js -->
	<script type="text/javascript" src="/js/md5.min.js"></script>
	<!-- common.js -->
	<script type="text/javascript" src="/js/common.js"></script>


	<script>

		// function getMiaoshaResult(goodsId){
		// 	g_showLoading();
		// 	$.ajax({
		// 		url:"/miaosha/result",
		// 		type:"GET",
		// 		data:{
		// 			goodsId:$("#goodsId").val(),
		// 		},
		// 		success:function(data){
		// 			if(data.code == 0){
		// 				var result = data.data;
		// 				if(result < 0){
		// 					layer.msg("对不起，秒杀失败");
		// 				}else if(result == 0){//继续轮询
		// 					setTimeout(function(){
		// 						getMiaoshaResult(goodsId);
		// 					}, 50);
		// 				}else{
		// 					layer.confirm("恭喜你，秒杀成功！查看订单？", {btn:["确定","取消"]},
		// 							function(){
		// 								window.location.href="/order_detail.htm?orderId="+result;
		// 							},
		// 							function(){
		// 								layer.closeAll();
		// 							});
		// 				}
		// 			}else{
		// 				layer.msg(data.msg);
		// 			}
		// 		},
		// 		error:function(){
		// 			layer.msg("客户端请求有误");
		// 		}
		// 	});
		// }

		function doMiaosha(){
			$.ajax({
				url:"/groupMiaosha/do_miaosha",
				type:"POST",
				data:{
					goodsId:$("#goodsId").val(),
				},
				success:function(data){
					if(data.code == 0){
						layer.confirm("恭喜你，秒杀成功！查看订单？", {btn:["确定","取消"]},
								function(){
									window.location.href="/orderDetail_group.htm?orderId="+data.data.id;
								},
								function(){
									layer.closeAll();
								});
						// window.location.href="/order_detail.htm?orderId="+data.data.id;
						// getMiaoshaResult($("#goodsId").val());
					}else{
						layer.msg(data.msg);
					}
				},
				error:function(){
					layer.msg("客户端请求有误");
				}
			});

		}

		function render(detail){
			var miaoshaStatus = detail.miaoshaStatus;
			var  remainSeconds = detail.remainSeconds;
			var goods = detail.goods;
			var user = detail.user;
			if(user){
				$("#userTip").hide();
			}
			$("#goodsName").text(goods.goodsName);
			$("#goodsImg").attr("src", goods.goodsImg);
			$("#startTime").text(new Date(goods.startDate).format("yyyy-MM-dd hh:mm:ss"));
			$("#remainSeconds").val(remainSeconds);
			$("#goodsId").val(goods.id);
			$("#goodsPrice").text(goods.goodsPrice);
			$("#miaoshaPrice").text(goods.miaoshaPrice);
			$("#stockCount").text(goods.stockCount);
			countDown();
		}

		$(function(){
			//countDown();
			getDetail();
		});

		function getDetail(){
			var goodsId = g_getQueryString("goodsId");
			$.ajax({
				url:"/groupMiaosha/detail/"+goodsId,
				type:"GET",
				success:function(data){
					if(data.code == 0){
						render(data.data);
					}else{
						layer.msg(data.msg);
					}
				},
				error:function(){
					layer.msg("客户端请求有误");
				}
			});
		}

		function countDown(){
			var remainSeconds = $("#remainSeconds").val();
			var timeout;
			if(remainSeconds > 0){//秒杀还没开始，倒计时
				$("#buyButton").attr("disabled", true);
				$("#miaoshaTip").html("秒杀倒计时："+remainSeconds+"秒");
				timeout = setTimeout(function(){
					$("#countDown").text(remainSeconds - 1);
					$("#remainSeconds").val(remainSeconds - 1);
					countDown();
				},1000);
			}else if(remainSeconds == 0){//秒杀进行中
				$("#buyButton").attr("disabled", false);
				if(timeout){
					clearTimeout(timeout);
				}
				$("#miaoshaTip").html("秒杀进行中");
			}else{//秒杀已经结束
				$("#buyButton").attr("disabled", true);
				$("#miaoshaTip").html("秒杀已经结束");
			}
		}

	</script>
</head>
<body>
	<div class="head-line"></div>

	<div id="head"></div>

	<div class="page-wrap single shop">
		<!-- Breadcrumbs -->
		<nav aria-label="breadcrumb" class="page-breadcrumb">
			<div class="container">
				<ol class="breadcrumb">
					<li class="breadcrumb-item"><a href="/">主页</a></li>
					<li class="breadcrumb-item active" aria-current="page">团购秒杀</a></li>
				</ol>
			</div>
		</nav>

		<div class="page-content">
			<main class="main-content">
				<section class="section-single-product product">
					<div class="container">
						<div class="row">
							<div class="col-lg-5">
								<div class="product-thumb">
									<span class="onsale">-??%</span>
									<div class="product-gallery">
										<div id="js-product-big" class="product-gallery__big">
											<img id="goodsImg" alt="">
										</div>
<!--										<div id="js-product-nav" class="product-gallery-thumbs">-->
<!--											<div class="product-gallery-thumbs__item active" data-large-src="images/05_home_page_001.jpg">-->
<!--												<img src="images/05_home_page_001.jpg" alt="">-->
<!--											</div>-->
<!--											<div class="product-gallery-thumbs__item" data-large-src="images/product-single-big-2.jpg">-->
<!--												<img src="images/05_home_page_003.jpg" alt="">-->
<!--											</div>-->
<!--											<div class="product-gallery-thumbs__item" data-large-src="images/product-single-big-3.jpg">-->
<!--												<img src="images/05_home_page_004.jpg" alt="">-->
<!--											</div>-->
<!--											<div class="product-gallery-thumbs__item" data-large-src="images/product-single-big-4.jpg">-->
<!--												<img src="images/05_home_page_005.jpg" alt="">-->
<!--											</div>-->
<!--											<div class="product-gallery-thumbs__item" data-large-src="images/product-single-big-5.jpg">-->
<!--												<img src="images/05_home_page_006.jpg" alt="">-->
<!--											</div>-->
<!--											<div class="product-gallery-thumbs__item" data-large-src="images/product-single-big-6.jpg">-->
<!--												<img src="images/05_home_page_007.jpg" alt="">-->
<!--											</div>-->
<!--										</div>-->
									</div>
								</div>s
							</div>

							<div class="product-summary summary col-lg-7">
								<h1 class="h2 product-title" id="goodsName"></h1>

								<div class="price">
									<ins><span class="amount" id="miaoshaPrice"></span></ins>
									<del><span class="amount" id="goodsPrice"></span></del>
								</div>

								<div class="price">
									<ins><span class="amount" >库存</span></ins>
									<del><span class="amount" id="stockCount"></span></del>
								</div>

								<tr>
									<td>秒杀开始时间</td>
									<td id="startTime"></td>
									<td >
										<input type="hidden" id="remainSeconds" />
										<span id="miaoshaTip"></span>
									</td>
									<td>
										<!--
                                            <form id="miaoshaForm" method="post" action="/miaosha/do_miaosha">
                                                <button class="btn btn-primary btn-block" type="submit" id="buyButton">立即秒杀</button>
                                                <input type="hidden" name="goodsId"  id="goodsId" />
                                            </form>-->
										<button class="btn btn-primary btn-block" type="button" id="buyButton"onclick="doMiaosha()">立即秒杀</button>
										<input type="hidden" name="goodsId"  id="goodsId" />
									</td>
								</tr>

<!--								<form action="/" class="cart-form">-->
<!--									<div class="cart-form__item quantity quantity">-->
<!--										<label for="quantity">数量:</label>-->

<!--									</div>-->

<!--									<div class="color-variants">-->
<!--										<div>颜色: <span id="active-color">灰色</span></div>-->
<!--										<ul class="colors-list">-->
<!--											<li class="colors-list__item colors-list__item_active"><a href="single-product.htm"><span class="prod-color" style="background-color: #7E7D82"></span></a></li>-->
<!--											<li class="colors-list__item"><a href="single-product.htm"><span class="prod-color" style="background-color: #333339"></span></a></li>-->
<!--										</ul>-->
<!--									</div>-->
<!--								</form>-->

<!--								<a href="cart.html" class="btn btn-primary btn-lg add_to_cart_button">加入购物车</a>-->

								<div class="product-summary__featured">
									<div class="row">
										<div class="product-featured-item">
											<div class="icon-box icon-box-left icon-box-circle">
												<div class="icon-box__icon"><i class="flaticon flaticon-delivery-truck"></i></div>
												<div class="icon-box__title">免运费</div>
											</div>
										</div>
										<div class="product-featured-item">
											<div class="icon-box icon-box-left icon-box-circle">
												<div class="icon-box__icon"><i class="flaticon flaticon-blocked-padlock"></i></div>
												<div class="icon-box__title">100% 安全保证</div>
											</div>
										</div>
										<div class="product-featured-item">
											<div class="icon-box icon-box-left icon-box-circle">
												<div class="icon-box__icon"><i class="flaticon flaticon-refresh-page-arrow"></i></div>
												<div class="icon-box__title">30 天质保</div>
											</div>
										</div>
									</div>
								</div>

								<div class="product-summary__share">
									<div>分享朋友，立享最低折扣:</div>

									<ul class="social-links">
										<li><a href="#"><i class="mdi mdi-pinterest"></i></a></li>
										<li><a href="#"><i class="mdi mdi-facebook"></i></a></li>
										<li><a href="#"><i class="mdi mdi-instagram"></i></a></li>
										<li><a href="#"><i class="mdi mdi-twitter"></i></a></li>
									</ul>
								</div>

								<div class="description-block">
									<h3 class="mb-30">商品详情&nbsp;</h3>

									<div class="product-description text-content">
										<ins><span class="amount" id="goodsTitle"></span></ins>

									</div>
								</div>
								<div class="product-attributes">
									<div class="product-attributes__item">
										<strong>Material:</strong>
										Body — 100% cotton trims / other — 100% polyurethane.
									</div>
									<div class="product-attributes__item">
										<strong>Care:</strong>
										Wipe clean with a damp sponge, do not dry clean, do not iron
									</div>
								</div>
							</div>
						</div>
					</div>
				</section>

				<section class="section-related">
					<div class="container">
						<h2 class="section-title text-center h3">Other items you may like</h2>
						<ul class="products featured-products columns-5">
							<li class="product">
								<div class="product-thumb">
									<span class="onsale">-30%</span>
									<a href="single-product.htm" class="product-thumb__link">
										<img src="images/01_home_page_005.jpg" alt="">
										<span class="btn btn-outline-light shop-link">Shop</span>
									</a>
								</div>
								<div class="product-title"><a href="single-product.htm">Cogen warm lamp</a></div>
								<div class="price">
									<span class="amount">$56.00</span>
								</div>
							</li>
							<li class="product">
								<div class="product-thumb">
									<a href="single-product.htm" class="product-thumb__link">
										<img src="images/02_catalogue_page_010.jpg" alt="">
										<span class="btn btn-outline-light shop-link">Shop</span>
									</a>
								</div>
								<div class="product-title"><a href="single-product.htm">Green Card pen</a></div>
								<div class="price">
									<span class="amount">$12.00</span>
								</div>
							</li>
							<li class="product">
								<div class="product-thumb">
									<a href="single-product.htm" class="product-thumb__link">
										<img src="images/02_catalogue_page_011.jpg" alt="">
										<span class="btn btn-outline-light shop-link">Shop</span>
									</a>
								</div>
								<div class="product-title"><a href="single-product.htm">CONFETTI LAMP</a></div>
								<div class="price">
									<span class="amount">$45.00</span>
								</div>
							</li>
							<li class="product">
								<div class="product-thumb">
									<a href="single-product.htm" class="product-thumb__link">
										<img src="images/02_catalogue_page_012.jpg" alt="">
										<span class="btn btn-outline-light shop-link">Shop</span>
									</a>
								</div>
								<div class="product-title"><a href="single-product.htm">HOT TABLET COVER</a></div>
								<div class="price">
									<span class="amount">$20.00</span>
								</div>
							</li>
							<li class="product">
								<div class="product-thumb">
									<a href="single-product.htm" class="product-thumb__link">
										<img src="images/02_catalogue_page_008.jpg" alt="">
										<span class="btn btn-outline-light shop-link">Shop</span>
									</a>
								</div>
								<div class="product-title"><a href="single-product.htm">COSMO ICE BOTTLE</a></div>
								<div class="price">
									<span class="amount">$27.00</span>
								</div>
							</li>
						</ul>
					</div>
				</section>
			</main>
		</div>
	</div>

	<div id="footer"></div>
	<script type="text/javascript">
		$('#head').load('header.html');
		$('#footer').load('footer.html');
	</script>

	<!-- Libs -->
	<script src="libs/jquery-2.2.3.min.js"></script>
	<script src="libs/bootstrap-4.3.1/js/bootstrap.min.js"></script>
	<script src="libs/select2/js/select2.min.js"></script>
	<script src="libs/slick/slick.min.js"></script>

	<!-- Theme -->
	<script src="assets/js/custom.js"></script>
</body>
</html>